{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/CiscoMeraki/Connector/MerakiConnector/logo.jpg\"width=\"75px\"height=\"75px\">\n\n**Important:** _This Microsoft Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe [Cisco Meraki](https://meraki.cisco.com/) Solution for Microsoft Sentinel enables you to easily ingest [logs](https://documentation.meraki.com/General_Administration/Monitoring_and_Reporting/Syslog_Event_Types_and_Log_Samples) from Cisco Meraki appliances to Microsoft Sentinel using syslog. This enables you to view and analyze this data in your workbooks, query it to create custom alerts, and incorporate it to improve your investigation process, giving you more insight into your platform security. The solutions also contains playbooks to automatically remediate threats using Cisco Meraki devices, enhancing the security functionality.\n\n**Underlying Microsoft Technologies used:**\n\rThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\n\ra. [Data collection using Syslog in Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/connect-syslog)\n\nMicrosoft Sentinel Solutions provide a consolidated way to acquire Microsoft Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Data Connectors:** 1, **Parsers:** 1, **Playbooks:** 6\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Solution installs the data connector for Cisco Meraki. You can get Cisco Meraki custom log data in your Microsoft Sentinel workspace. Configure and enable this data connector in the Data Connector gallery after this Solution deploys. This data connector creates custom log table(s) meraki_CL in your Microsoft Sentinel / Azure Log Analytics workspace."
            }
          },
          {
            "name": "dataconnectors-parser-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "The Solution installs a parser that transforms the ingested data into Microsoft Sentinel normalized format. The normalized format enables better correlation of different types of data from different data sources to drive end-to-end outcomes seamlessly in security monitoring, hunting, incident investigation and response scenarios in Microsoft Sentinel."
            }
          },
          {
            "name": "dataconnectors-link1",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about normalized format",
                "uri": "https://docs.microsoft.com/azure/sentinel/normalization-schema"
              }
            }
          },
          {
            "name": "dataconnectors-link2",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs playbook resources.  A security playbook is a collection of procedures that can be run from Microsoft Sentinel in response to an alert. A security playbook can help automate and orchestrate your response, and can be run manually or set to run automatically when specific alerts are triggered. Security playbooks in Microsoft Sentinel are based on Azure Logic Apps, which means that you get all the power, customizability, and built-in templates of Logic Apps. Each playbook is created for the specific subscription you choose, but when you look at the Playbooks page, you will see all the playbooks across any selected subscriptions.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "playbook1",
            "type": "Microsoft.Common.Section",
            "elements": [
              {
                "name": "playbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This custom connector connects to Cisco Meraki Dashboard API service endpoint and programmatically manages and monitors Meraki networks at scale."
                }
              },
              {
                "name": "playbook1-CustomConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Custom Connector Name"
                }
              },
              {
                "name": "playbook1-ApiKey",
                "type": "Microsoft.Common.TextBox",		  
						  
                "label": "ApiKey",  
				  
                "toolTip": "ApiKey to connect to Cisco Meraki API",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the ApiKey"
										  
                }
              },
              {
                "name": "playbook1-ServiceEndPoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Service End Point",
                "defaultValue": "https://api-mp.meraki.com/api/v1",
                "toolTip": "Please enter Service End Point",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Service End Point"
                }
              }
            ]
          },
          {
            "name": "playbook2",
            "type": "Microsoft.Common.Section",
            "label": "Block-Device-Client-Meraki",
            "elements": [
              {
                "name": "playbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Cisco Meraki into Log Analytics using the API."
                }
              },
              {
                "name": "playbook2-PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Block-Device-Client-Meraki",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "playbook2-CiscoMerakiConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Cisco Meraki Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Cisco Meraki Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Cisco Meraki Connector Name"
                }
              },
              {
                "name": "playbook2-OrganizationName",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "defaultValue": "",
                "toolTip": "Please enter Organization Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Name"
                }
              },
              {
                "name": "playbook2-NetworkName",
                "type": "Microsoft.Common.TextBox",
                "label": "Network Name",
                "defaultValue": "",
                "toolTip": "Please enter Network Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Network Name"
                }
              },
              {
                "name": "playbook2-GroupPolicy",
                "type": "Microsoft.Common.TextBox",
                "label": "Group Policy",
                "defaultValue": "",
                "toolTip": "Please enter Group Policy",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Group Policy"
                }
              }
            ]
          },
          {
            "name": "playbook3",
            "type": "Microsoft.Common.Section",
            "label": "Block-IP-Address-Meraki",
            "elements": [
              {
                "name": "playbook3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Cisco Meraki into Log Analytics using the API."
                }
              },
              {
                "name": "playbook3-PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Block-IP-Address-Meraki",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "playbook3-CiscoMerakiConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Cisco Meraki Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Cisco Meraki Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Cisco Meraki Connector Name"
                }
              },
              {
                "name": "playbook3-OrganizationName",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "defaultValue": "",
                "toolTip": "Please enter Organization Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Name"
                }
              },
              {
                "name": "playbook3-NetworkName",
                "type": "Microsoft.Common.TextBox",
                "label": "Network Name",
                "defaultValue": "",
                "toolTip": "Please enter Network Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Network Name"
                }
              }
            ]
          },
          {
            "name": "playbook4",
            "type": "Microsoft.Common.Section",
            "label": "Block-URL-Meraki",
            "elements": [
              {
                "name": "playbook4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Cisco Meraki into Log Analytics using the API."
                }
              },
              {
                "name": "playbook4-PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Block-URL-Meraki",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "playbook4-CiscoMerakiConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Cisco Meraki Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Cisco Meraki Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Cisco Meraki Connector Name"
                }
              },
              {
                "name": "playbook4-OrganizationName",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "defaultValue": "",
                "toolTip": "Please enter Organization Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Name"
                }
              },
              {
                "name": "playbook4-NetworkName",
                "type": "Microsoft.Common.TextBox",
                "label": "Network Name",
                "defaultValue": "",
                "toolTip": "Please enter Network Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Network Name"
                }
              }
            ]
          },
          {
            "name": "playbook5",
            "type": "Microsoft.Common.Section",
            "label": "IP-Enrichment-Meraki",
            "elements": [
              {
                "name": "playbook5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Cisco Meraki into Log Analytics using the API."
                }
              },
              {
                "name": "playbook5-PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "IP-Enrichment-Meraki",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "playbook5-CiscoMerakiConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Cisco Meraki Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Cisco Meraki Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Cisco Meraki Connector Name"
                }
              },
              {
                "name": "playbook5-OrganizationName",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "defaultValue": "",
                "toolTip": "Please enter Organization Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Name"
                }
              }
            ]
          },
          {
            "name": "playbook6",
            "type": "Microsoft.Common.Section",
            "label": "URL-Enrichment-Meraki",
            "elements": [
              {
                "name": "playbook6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Cisco Meraki into Log Analytics using the API."
                }
              },
              {
                "name": "playbook6-PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "URL-Enrichment-Meraki",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "playbook6-CiscoMerakiConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Cisco Meraki Connector Name",
                "defaultValue": "MerakiConnector",
                "toolTip": "Please enter Cisco Meraki Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Cisco Meraki Connector Name"
                }
              },
              {
                "name": "playbook6-OrganizationName",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "defaultValue": "",
                "toolTip": "Please enter Organization Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Name"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "playbook1-CustomConnectorName": "[steps('playbooks').playbook1.playbook1-CustomConnectorName]",
      "playbook1-ApiKey": "[steps('playbooks').playbook1.playbook1-ApiKey]",
      "playbook1-ServiceEndPoint": "[steps('playbooks').playbook1.playbook1-ServiceEndPoint]",
      "playbook2-PlaybookName": "[steps('playbooks').playbook2.playbook2-PlaybookName]",
      "playbook2-CiscoMerakiConnectorName": "[steps('playbooks').playbook2.playbook2-CiscoMerakiConnectorName]",
      "playbook2-OrganizationName": "[steps('playbooks').playbook2.playbook2-OrganizationName]",
      "playbook2-NetworkName": "[steps('playbooks').playbook2.playbook2-NetworkName]",
      "playbook2-GroupPolicy": "[steps('playbooks').playbook2.playbook2-GroupPolicy]",
      "playbook3-PlaybookName": "[steps('playbooks').playbook3.playbook3-PlaybookName]",
      "playbook3-CiscoMerakiConnectorName": "[steps('playbooks').playbook3.playbook3-CiscoMerakiConnectorName]",
      "playbook3-OrganizationName": "[steps('playbooks').playbook3.playbook3-OrganizationName]",
      "playbook3-NetworkName": "[steps('playbooks').playbook3.playbook3-NetworkName]",
      "playbook4-PlaybookName": "[steps('playbooks').playbook4.playbook4-PlaybookName]",
      "playbook4-CiscoMerakiConnectorName": "[steps('playbooks').playbook4.playbook4-CiscoMerakiConnectorName]",
      "playbook4-OrganizationName": "[steps('playbooks').playbook4.playbook4-OrganizationName]",
      "playbook4-NetworkName": "[steps('playbooks').playbook4.playbook4-NetworkName]",
      "playbook5-PlaybookName": "[steps('playbooks').playbook5.playbook5-PlaybookName]",
      "playbook5-CiscoMerakiConnectorName": "[steps('playbooks').playbook5.playbook5-CiscoMerakiConnectorName]",
      "playbook5-OrganizationName": "[steps('playbooks').playbook5.playbook5-OrganizationName]",
      "playbook6-PlaybookName": "[steps('playbooks').playbook6.playbook6-PlaybookName]",
      "playbook6-CiscoMerakiConnectorName": "[steps('playbooks').playbook6.playbook6-CiscoMerakiConnectorName]",
      "playbook6-OrganizationName": "[steps('playbooks').playbook6.playbook6-OrganizationName]"
    }
  }
}
